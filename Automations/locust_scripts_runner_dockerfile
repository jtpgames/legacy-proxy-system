FROM python:3.11-slim

WORKDIR /app

# Install Git and required dependencies
RUN apt-get update && \
    apt-get install -y --no-install-recommends git && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# Copy only the requirements first to leverage Docker layer caching
COPY locust_scripts/requirements.txt .
COPY locust_scripts/common_requirements.txt .

# Create virtual environment and install dependencies
RUN python -m venv venv && \
    . venv/bin/activate && \
    pip install --upgrade pip && \
    pip install -r requirements.txt

# Copy all locust scripts and other files
COPY locust_scripts/ .

RUN echo "Contents of /app:" && ls -l /app

# Copy the entrypoint from Automations directory
COPY Automations/docker-entrypoint.sh .

RUN chmod +x docker-entrypoint.sh

ENTRYPOINT ["./docker-entrypoint.sh"]

CMD ["bash"]

